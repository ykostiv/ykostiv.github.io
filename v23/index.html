  <!doctype html>

  <title>CodeMirror</title>
  <meta charset="utf-8"/>

  <link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto|Source+Code+Pro&display=swap">
  <link rel=stylesheet href="lib/codemirror.css"></link>
  <link rel=stylesheet href="v23web.css"></link>
  <link rel=stylesheet href="theme/nord.css"></link>
  <link rel=stylesheet href="addon/lint/lint.css"></link>
  <link rel=stylesheet href="addon/fold/foldgutter.css"></link>
  <script src="lib/codemirror.js"></script>
  <script src="mode/yaml/yaml.js"></script>
  <script src="addon/selection/active-line.js"></script>
  <script src="addon/fold/indent-fold.js"></script>
  <script src="addon/fold/foldcode.js"></script>
  <script src="addon/lint/lint.js"></script>
  <script src="addon/lint/yaml-lint.js"></script>
  <script src="https://cdn.jsdelivr.net/es5.shim/4.4.1/es5-shim.min.js"></script>

  <script src="lib/js-yaml.min.js"></script>
  <script src="v23web.js"></script>

  <article>

  <section id=content>
    <div class="header">
      <img src="Logo.png" alt="logo" />
      <h1>  YAML v2 to v3 converter</h1>
    </div>
    <div class="content">
      <div class="src">
        <h4 class="subheader">Edit source v2 YAML here:</h4>
        <textarea id="source">
version: v2
navigator:
  name: John Doe
  email: john.doe@trilogy.com
tickets:
  engImportTicket: https://jira.devfactory.com/browse/Y3K-1
  devHubTicket:    https://jira.devfactory.com/browse/Y3K-2
  dockerTicket:    null
  devSpacesTicket: null
  vmTicket:        null
repo:
  companyName: Think3
  productName: SLIAO
  repoUrl: https://github.com/trilogy-group/think3-sli-templatebuilder-modules-client-release-service
  repoBranch: master
  repoType: Third party managed service
build:
  preBuild: .cicd/ci/env-build.sh
  buildCommand: mvn compile
  credentials:
  - class: string
    credentialsId: sli-github-read-token
    variable: GITHUB_READ_TOKEN
buildenvVars:
  - key: "GITHUB_READ_TOKEN"
    secret: true
    secretId: "devhub-import/env/GITHUB-SLI-TOKEN"
test:
  preTest: null
  testCommand: mvn test
package:
  packageTool: Maven
  packageCommand: mvn package
  artifactDir: target
  artifactUploadCommand: .cicd/ci/package.sh
  credentials:
    - class: usernamePassword
      credentialsId: slisys-jenkins
      usernameVariable: GITHUB_SLI_USERNAME
      passwordVariable: GITHUB_SLI_PASSWORD
ports:
    - name: http
      number: 8000
      protocol: http
      public: true
jenkins:
  productPath: /SLI-Systems/YAML/SLIAO
  agentLabel: slisys-tbslave
  pipelines:
    ci:
      environment: null
    ib:
      environment:
        PKG_TYPE: snapshot
      deployEnv: qa
    rc:
      environment:
        PKG_TYPE: release
      deployEnv: stage
deploy_qa:
  deploy:
    deployCommand: .cicd/ib/deploy.sh
    deploymentCheck: .cicd/ib/healthcheck.sh
    credentials:
    - class: usernamePassword
      credentialsId: central-release-user
      usernameVariable: RD_USER
      passwordVariable: RD_PASSWORD
    envVars: null
    run: echo "managed by aura"
deploy_stage:
  deploy:
    deployCommand: .cicd/rc/deploy.sh
    deploymentCheck: .cicd/rc/healthcheck.sh
    credentials:
    - class: usernamePassword
      credentialsId: central-release-user
      usernameVariable: RD_USER
      passwordVariable: RD_PASSWORD
    envVars: null
    run: echo "managed by aura"
        </textarea>
      </div>
      <div class="dst">
        <h4 class="subheader">Converted YAML v3 is here:</h4>
        <textarea id="result">
        </textarea>
      </div>
      <div class="gh-ribbon">
        <a href="https://sites.google.com/devfactory.com/devhub" target="_blank" title="DevHub Portal">DevHub</a>
      </div>
    </div>
    <script>

      window.onload = function () {

        source = CodeMirror.fromTextArea(document.getElementById('source'), {
          mode: 'text/yaml',
          lineNumbers: true,
          styleActiveLine: true,
          theme: "nord"
        });

        var v2 = jsyaml.safeLoad(source.options.value);
        if (v2.version != "v2") {
          result = "\nSource is not a V2 YAML\n";
        } else {
          var v3 = convert(v2);
          var result = jsyaml.safeDump(v3);
        }

        document.getElementById('result').innerHTML = result;

        var target = CodeMirror.fromTextArea(document.getElementById('result'), {
          lineNumbers: false,
          mode: "text/yaml",
          styleActiveLine: false,
          readOnly: true,
          theme: "nord"
        });

        var timer;

        source.on('change', function () {
          var ddoc = source.doc.getValue();
          clearTimeout(timer);
          timer = setTimeout( function () {
            try {
              v2 = jsyaml.safeLoad(ddoc);
              if (v2.version != "v2") {
                result = "\nSource is not a V2 YAML\n";
              } else {
                v3 = convert(v2);
                result = jsyaml.safeDump(v3);
              }
            } catch (e) {
              result = "\nSource is not V2 YAML\n";
            }
            target.doc.setValue(result);
          }, 500);

        });
      };

    </script>
  </section>
  </article>
